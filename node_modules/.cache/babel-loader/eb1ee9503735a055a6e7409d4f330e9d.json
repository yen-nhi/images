{"ast":null,"code":"import _toConsumableArray from \"/home/nhi/images/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"/home/nhi/images/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\n\nvar _jsxFileName = \"/home/nhi/images/src/components/Canvas.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport classes from './Canvas.module.css';\nimport React, { useRef, useEffect, useState, useCallback } from 'react';\nimport BoxForm from \"./BoxForm\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar Canvas = function Canvas(props) {\n  _s();\n\n  var canvas = useRef();\n  var image = new Image();\n  image.src = props.imageUrl;\n  image.className = classes.image;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      currentBox = _useState2[0],\n      setCurrentBox = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      boxes = _useState4[0],\n      setBoxes = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      annotated = _useState6[0],\n      setAnnotated = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      newDraw = _useState8[0],\n      _setNewDraw = _useState8[1];\n\n  var _useState9 = useState({\n    x: 0,\n    y: 0,\n    w: 0,\n    h: 0\n  }),\n      _useState10 = _slicedToArray(_useState9, 2),\n      coordinate = _useState10[0],\n      setCoordinate = _useState10[1];\n\n  var _useState11 = useState(true),\n      _useState12 = _slicedToArray(_useState11, 2),\n      firstBox = _useState12[0],\n      setFirstBox = _useState12[1];\n\n  var drawBox = function drawBox(ctx, box) {\n    var _box$coor = box.coor,\n        x = _box$coor.x,\n        y = _box$coor.y,\n        w = _box$coor.w,\n        h = _box$coor.h;\n    ctx.beginPath();\n    ctx.strokeStyle = 'blue';\n    ctx.lineWidth = 1;\n    ctx.rect(x, y, w, h);\n    ctx.stroke();\n    ctx.font = \"20px Arial\";\n    ctx.fillText(box.desc, x, y - 5);\n  };\n\n  var drawBoxes = function drawBoxes() {\n    var canvasEle = canvas.current;\n    canvasEle.width = canvasEle.clientWidth;\n    canvasEle.height = canvasEle.clientHeight;\n    var ctx = canvasEle.getContext(\"2d\");\n    ctx.clearRect(0, 0, canvas.current.clientWidth, canvas.current.clientHeight);\n    ctx.drawImage(image, 0, 0, 500, 500);\n    boxes.map(function (box) {\n      return drawBox(ctx, box);\n    });\n\n    if (currentBox !== null) {\n      drawBox(ctx, currentBox);\n    }\n  };\n\n  var handleMouseDown = function handleMouseDown(e) {\n    console.log('DOWN');\n\n    if (!firstBox && !annotated) {\n      boxes.pop();\n      setBoxes(boxes);\n    }\n\n    var x = parseInt(e.nativeEvent.offsetX - canvas.current.clientLeft);\n    var y = parseInt(e.nativeEvent.offsetY - canvas.current.clientTop);\n    setCurrentBox({\n      coor: {\n        x: x,\n        y: y,\n        w: 0,\n        h: 0\n      },\n      desc: ''\n    });\n    setAnnotated(false);\n\n    _setNewDraw(false);\n  };\n\n  var handleMouseUp = function handleMouseUp(e) {\n    console.log('UP');\n\n    if (currentBox !== null && currentBox.coor.w !== 0 && currentBox.coor.h !== 0) {\n      setBoxes([].concat(_toConsumableArray(boxes), [currentBox]));\n      setCoordinate(currentBox.coor);\n\n      _setNewDraw(true);\n\n      setFirstBox(false);\n      drawBoxes();\n    }\n\n    setCurrentBox(null);\n  };\n\n  var handleMouseOut = useCallback(function (e) {\n    console.log('OUT');\n    setCurrentBox(null);\n    drawBoxes();\n  }, [currentBox]);\n\n  var handleMouseMove = function handleMouseMove(e) {\n    console.log('MOVE');\n\n    if (currentBox !== null) {\n      var _currentBox$coor = currentBox.coor,\n          x = _currentBox$coor.x,\n          y = _currentBox$coor.y,\n          w = _currentBox$coor.w,\n          h = _currentBox$coor.h;\n      var mouseX = parseInt(e.nativeEvent.offsetX - canvas.current.clientLeft);\n      var mouseY = parseInt(e.nativeEvent.offsetY - canvas.current.clientTop);\n      setCurrentBox({\n        coor: {\n          x: x,\n          y: y,\n          w: mouseX - x,\n          h: mouseY - y\n        },\n        desc: ''\n      });\n      drawBoxes();\n    }\n  };\n\n  var annotationHandler = function annotationHandler(text) {\n    var arr = _toConsumableArray(boxes);\n\n    var lastBox = arr[arr.length - 1];\n    lastBox.desc = text;\n    setBoxes(arr);\n    setAnnotated(true);\n  }; // initialize the canvas context\n\n\n  useEffect(function () {// dynamically assign the width and height to canvas\n  }, []);\n  useEffect(function () {\n    drawBoxes();\n  }, [boxes]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: classes.page,\n    children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n      className: classes.canvasDrawing,\n      onMouseDown: handleMouseDown,\n      onMouseUp: handleMouseUp,\n      onMouseOut: handleMouseOut,\n      onMouseMove: handleMouseMove,\n      ref: canvas\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }, _this), newDraw && /*#__PURE__*/_jsxDEV(BoxForm, {\n      setNewDraw: function setNewDraw() {\n        return _setNewDraw(false);\n      },\n      coordinate: coordinate,\n      postAnnotation: annotationHandler,\n      url: props.imageUrl,\n      id: props.imageKey\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 21\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 7\n  }, _this);\n};\n\n_s(Canvas, \"Ggpe2PBNHPiwjrpnnz/UgrgyeeE=\");\n\n_c = Canvas;\nexport default Canvas;\n\nvar _c;\n\n$RefreshReg$(_c, \"Canvas\");","map":{"version":3,"sources":["/home/nhi/images/src/components/Canvas.js"],"names":["classes","React","useRef","useEffect","useState","useCallback","BoxForm","Canvas","props","canvas","image","Image","src","imageUrl","className","currentBox","setCurrentBox","boxes","setBoxes","annotated","setAnnotated","newDraw","setNewDraw","x","y","w","h","coordinate","setCoordinate","firstBox","setFirstBox","drawBox","ctx","box","coor","beginPath","strokeStyle","lineWidth","rect","stroke","font","fillText","desc","drawBoxes","canvasEle","current","width","clientWidth","height","clientHeight","getContext","clearRect","drawImage","map","handleMouseDown","e","console","log","pop","parseInt","nativeEvent","offsetX","clientLeft","offsetY","clientTop","handleMouseUp","handleMouseOut","handleMouseMove","mouseX","mouseY","annotationHandler","text","arr","lastBox","length","page","canvasDrawing","imageKey"],"mappings":"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","sourcesContent":["import classes from './Canvas.module.css';\nimport React, { useRef, useEffect, useState, useCallback } from 'react';\nimport BoxForm from \"./BoxForm\";\n\nconst Canvas = (props) => {\n  const canvas = useRef();\n  let image = new Image();\n  image.src = props.imageUrl;\n  image.className = classes.image;\n  const [currentBox, setCurrentBox] = useState(null);\n  const [boxes, setBoxes] = useState([]);\n  const [annotated, setAnnotated] = useState(false);\n  const [newDraw, setNewDraw] = useState(false);\n  const [coordinate, setCoordinate] = useState({x: 0, y: 0, w: 0, h: 0});\n  const [firstBox, setFirstBox] = useState(true);\n  \n  const drawBox = (ctx, box) => {\n    const { x, y, w, h } = box.coor;\n    ctx.beginPath();\n    ctx.strokeStyle = 'blue';\n    ctx.lineWidth = 1;\n    ctx.rect(x, y, w, h);\n    ctx.stroke();\n    ctx.font = \"20px Arial\";\n    ctx.fillText(box.desc, x, y - 5);\n    \n  }\n\n  const drawBoxes = () => {\n    const canvasEle = canvas.current;\n    canvasEle.width = canvasEle.clientWidth;\n    canvasEle.height = canvasEle.clientHeight;\n    let ctx = canvasEle.getContext(\"2d\");\n    \n    ctx.clearRect(0, 0, canvas.current.clientWidth, canvas.current.clientHeight);  \n    ctx.drawImage(image, 0, 0, 500, 500);\n    boxes.map(box => drawBox(ctx, box));\n    if (currentBox !== null) {\n      drawBox(ctx, currentBox);\n           \n    }\n  }\n\n  const handleMouseDown = e => {\n    console.log('DOWN');\n    if (!firstBox && !annotated) {\n      boxes.pop();\n      setBoxes(boxes);\n    } \n    const x = parseInt(e.nativeEvent.offsetX - canvas.current.clientLeft);\n    const y = parseInt(e.nativeEvent.offsetY - canvas.current.clientTop);\n    setCurrentBox({coor: {x, y, w: 0, h: 0}, desc: ''});  \n    setAnnotated(false);\n    setNewDraw(false);\n  }  \n\n  const handleMouseUp = e => {\n    console.log('UP');\n\n    if (currentBox !== null && currentBox.coor.w !== 0 && currentBox.coor.h !== 0) {\n      setBoxes([...boxes, currentBox]);\n      setCoordinate(currentBox.coor);\n      setNewDraw(true);\n      setFirstBox(false);\n      drawBoxes();\n    }\n    setCurrentBox(null); \n  }  \n\n  const handleMouseOut = useCallback( (e) => {\n    console.log('OUT');\n\n    setCurrentBox(null);\n    drawBoxes();\n  }, [currentBox]);\n\n  const handleMouseMove = e => {\n    console.log('MOVE');\n\n    if (currentBox !== null) {\n      const { x, y, w, h } = currentBox.coor;\n      const mouseX = parseInt(e.nativeEvent.offsetX - canvas.current.clientLeft);\n      const mouseY = parseInt(e.nativeEvent.offsetY - canvas.current.clientTop);\n      setCurrentBox({coor: {x, y, w: mouseX - x, h: mouseY - y}, desc: ''});\n      drawBoxes();\n    }\n  }\n\n  const annotationHandler = (text) => {\n    let arr = [...boxes];\n    let lastBox = arr[arr.length-1];\n    lastBox.desc = text;\n    setBoxes(arr);\n    setAnnotated(true);\n  };\n\n\n  // initialize the canvas context\n  useEffect(() => {\n    // dynamically assign the width and height to canvas\n  }, []);\n\n  useEffect(() => {   \n    drawBoxes();\n  }, [boxes]);\n\n  return (\n      <div className={classes.page}>\n        <canvas \n          className={classes.canvasDrawing}\n          onMouseDown={handleMouseDown} \n          onMouseUp={handleMouseUp}\n          onMouseOut={handleMouseOut}\n          onMouseMove={handleMouseMove}\n          ref={canvas}>    \n        </canvas>\n        {newDraw && <BoxForm \n          setNewDraw={() => setNewDraw(false)}\n          coordinate={coordinate}\n          postAnnotation={annotationHandler}\n          url={props.imageUrl}\n          id={props.imageKey}\n          />}\n      </div>\n      );\n}\n\nexport default Canvas;"]},"metadata":{},"sourceType":"module"}